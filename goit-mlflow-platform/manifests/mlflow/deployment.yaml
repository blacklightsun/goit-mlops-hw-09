apiVersion: apps/v1
kind: Deployment
metadata:
  name: mlflow-deployment
  namespace: mlflow
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mlflow
  template:
    metadata:
      labels:
        app: mlflow
    spec:
      containers:
        - name: mlflow-container
          image: ghcr.io/mlflow/mlflow:latest
          command: ["mlflow", "server"]
          args: [
                "--host", "0.0.0.0",
                "--backend-store-uri", "sqlite:////mlflow-data/mlflow.db",     # ‚úÖ –ó–ê–õ–ò–®–ê–Ñ–ú–û: –ú–µ—Ç–∞–¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫—É.
                "--artifacts-destination", "s3://mlflow-artifacts"            # ‚¨ÖÔ∏è –ó–ú–Ü–ù–ï–ù–û: –í–∫–∞–∑—É—î–º–æ, —â–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ —Ç—Ä–µ–±–∞ –∫–ª–∞—Å—Ç–∏ –≤ S3-—Å—É–º—ñ—Å–Ω–µ —Å—Ö–æ–≤–∏—â–µ (MinIO) —É –±–∞–∫–µ—Ç 'mlflow-artifacts'.
          ]
          
          # ‚ùóÔ∏è –î–û–î–ê–ù–û: –°–µ–∫—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MinIO.
          env:
            # –í–∫–∞–∑—É—î–º–æ MLflow –∞–¥—Ä–µ—Å—É –Ω–∞—à–æ–≥–æ MinIO —Å–µ—Ä–≤–µ—Ä–∞.
            # –¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—è DNS-–∞–¥—Ä–µ—Å–∞ Kubernetes: <service-name>.<namespace>.svc.cluster.local:<port>
            - name: MLFLOW_S3_ENDPOINT_URL
              value: "http://minio-service.minio.svc.cluster.local:9000"

            # üîë –ë–µ—Ä–µ–º–æ –∫–ª—é—á—ñ –¥–æ—Å—Ç—É–ø—É –∑ Kubernetes Secret, —è–∫–∏–π –≤–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –¥–ª—è MinIO.
            # –¶–µ –±–µ–∑–ø–µ—á–Ω–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ, –Ω–µ –∑–∞–ø–∏—Å—É—é—á–∏ —ó—Ö —É –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç.
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: minio-secret # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ Secret'–∞, —è–∫—â–æ –≤–æ–Ω–∞ —ñ–Ω—à–∞.
                  key: accessKey     # –ö–ª—é—á –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Secret'–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å Access Key.

            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-secret # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ Secret'–∞, —è–∫—â–æ –≤–æ–Ω–∞ —ñ–Ω—à–∞.
                  key: secretKey     # –ö–ª—é—á –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Secret'–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å Secret Key.

          ports:
            - containerPort: 5000
          
          volumeMounts:
            # –ú–æ–Ω—Ç—É—î–º–æ —Ç–æ–º, —è–∫ —ñ —Ä–∞–Ω—ñ—à–µ, –∞–ª–µ —Ç–µ–ø–µ—Ä –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò –¥–ª—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö SQLite.
            - name: mlflow-storage
              mountPath: /mlflow-data
      
      volumes:
        - name: mlflow-storage
          persistentVolumeClaim:
            claimName: mlflow-pvc